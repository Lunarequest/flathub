app-id: com.github.ytdl_gui.youtubedl_gui
runtime: org.kde.Platform
runtime-version: '5.15'
sdk: org.kde.Sdk
command: youtubedl-gui

finish-args:
  - --share=ipc
  - --socket=x11
  - --socket=wayland
  - --share=network
  - --device=dri
modules:
  - name: x264
    config-opts: 
      - --disable-cli
      - --enable-shared
    cleanup:
      - /include
    sources:
      - type: git
        url: https://code.videolan.org/videolan/x264.git
        commit: b86ae3c66f51ac9eab5ab7ad09a9d62e67961b8a

  - name: ffmpeg
    config-opts:
      -  --enable-gpl
      -  --enable-nonfree
      -  --disable-static
      -  --enable-shared     
      -  --disable-debug
      -  --disable-doc   
      -  --enable-libfdk-aac 
      -  --enable-libfreetype
      -  --enable-libmp3lame 
      -  --enable-libopus    
      -  --enable-libtheora  
      -  --enable-libvorbis  
      -  --disable-programs
      -  --disable-devices
    sources:
        - type: archive
          url: https://ffmpeg.org/releases/ffmpeg-4.4.tar.xz
          sha256: 06b10a183ce5371f915c6bb15b7b1fffbe046e8275099c96affc29e17645d909

  - python3-youtube-dl.json

  - name: youtubedl-gui
    buildsystem: cmake
    sources:
        - type: archive
          url: https://github.com/JaGoLi/ytdl-gui/archive/refs/tags/2.5.tar.gz
          sha256: d725f94061819f9366e6a170e9cebd06dd6bf824d180a13976f7b1f9bd8e5754
        - type: file
          path: com.github.ytdl_gui.youtubedl_gui.metainfo.xml
    post-install:
      - mv /app/share/icons/hicolor/64x64/apps/youtubedl-gui.png /app/share/icons/hicolor/64x64/apps/com.github.ytdl_gui.youtubedl_gui.png
      - mv /app/share/icons/hicolor/128x128/apps/youtubedl-gui.png /app/share/icons/hicolor/128x128/apps/com.github.ytdl_gui.youtubedl_gui.png
      - mv /app/share/icons/hicolor/256x256/apps/youtubedl-gui.png /app/share/icons/hicolor/256x256/apps/com.github.ytdl_gui.youtubedl_gui.png
      - mv /app/share/icons/hicolor/32x32/apps/youtubedl-gui.png /app/share/icons/hicolor/32x32/apps/com.github.ytdl_gui.youtubedl_gui.png
      - mv /app/share/icons/hicolor/512x512/apps/youtubedl-gui.png /app/share/icons/hicolor/512x512/apps/com.github.ytdl_gui.youtubedl_gui.png
      - mv /app/share/icons/hicolor/16x16/apps/youtubedl-gui.png /app/share/icons/hicolor/16x16/apps/com.github.ytdl_gui.youtubedl_gui.png
      - mv /app/share/applications/youtubedl-gui.desktop /app/share/applications/com.github.ytdl_gui.youtubedl_gui.desktop
      - sed -i '3d' /app/share/applications/com.github.ytdl_gui.youtubedl_gui.desktop
      - sed -i 's/Icon=youtubedl-gui/Icon=com.github.ytdl_gui.youtubedl_gui/g' /app/share/applications/com.github.ytdl_gui.youtubedl_gui.desktop
      - sed -i 's/Exec=\/usr\/bin\/youtubedl-gui/Exec=youtubedl-gui/g' /app/share/applications/com.github.ytdl_gui.youtubedl_gui.desktop
      - install -D com.github.ytdl_gui.youtubedl_gui.metainfo.xml -t /app/share/metainfo/